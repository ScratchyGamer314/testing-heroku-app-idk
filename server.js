var PORT = process.env.PORT || 3000; // take port from heroku or for loacalhost
var express = require("express");
var app = express(); // express app which is used boilerplate for HTTP
var http = require("http").Server(app);

//moment js
var moment = require("moment");

var clientInfo = {};

//socket io module
var io = require("socket.io")(http);

// expose the folder via express thought
app.use(express.static(__dirname + '/public'));

// send current users to provided scoket
function sendCurrentUsers(socket) { // loading current users
  var info = clientInfo[socket.id];
  var users = [];
  if (typeof info === 'undefined') {
    return;
  }
  // filte name based on rooms
  Object.keys(clientInfo).forEach(function(socketId) {
    var userinfo = clientInfo[socketId];
    // check if user room and selcted room same or not
    // as user should see names in only his chat room
    if (info.room == userinfo.room) {
      users.push(userinfo.name);
    }

  });
  // emit message when all users list

  socket.emit("message", {
    name: "System",
    text: "Current Users : " + users.join(', '),
    timestamp: moment().valueOf()
  });

}


// io.on listens for events
io.on("connection", function(socket) {
  console.log("User is connected");

  //for disconnection
  socket.on("disconnect", function() {
    var userdata = clientInfo[socket.id];
    if (typeof(userdata !== undefined)) {
      socket.leave(userdata.room); // leave the room
      //broadcast leave room to only memebers of same room
      socket.broadcast.to(userdata.room).emit("message", {
        text: userdata.name + " has left",
        name: "System",
        timestamp: moment().valueOf()
      });

      // delete user data-
      delete clientInfo[socket.id];

    }
  });

  // for private chat
  socket.on('joinRoom', function(req) {
    clientInfo[socket.id] = req;
    socket.join(req.room);
    //broadcast new user joined room
    socket.broadcast.to(req.room).emit("message", {
      name: "System",
      text: req.name + ' has joined',
      timestamp: moment().valueOf()
    });

  });

  // to show who is typing Message

  socket.on('typing', function(message) { // broadcast this message to all users in that room
    socket.broadcast.to(clientInfo[socket.id].room).emit("typing", message);
  });

  // to check if user seen Message
  socket.on("userSeen", function(msg) {
    socket.broadcast.to(clientInfo[socket.id].room).emit("userSeen", msg);
    //socket.emit("message", msg);

  });

  socket.emit("message", {
    text: "Welcome to My Chat Application!",
    timestamp: moment().valueOf(),
    name: "- System"
  });
  
  
    socket.emit("message", {
    text: "To start, share the link in the url bar to your friends or share the chat room with them. Please type anything in the text box below to start chatting.",
    timestamp: moment().valueOf(),
    name: "- Tip"
  });

  
    socket.emit("message", {
    text: "Here are a list of emoji: ğŸ˜‚ â¤ï¸ ğŸ˜	ğŸ˜Š ğŸ™ ğŸ’• ğŸ˜­ ğŸ‘ ğŸ˜… ğŸ‘ ğŸ˜ â™¥ï¸ ğŸ”¥ ğŸ’” ğŸ’– ğŸ’™ ğŸ˜¢ ğŸ¤” ğŸ˜† ğŸ™„ ğŸ’ª ğŸ˜‰ â˜ºï¸ ğŸ‘Œ ğŸ¤—ğŸ’œ ğŸ˜” ğŸ˜ ğŸ˜‡ ğŸŒ¹ ğŸ¤¦ ğŸ‰ â€¼ï¸ ğŸ’ âœŒï¸ âœ¨ ğŸ¤· ğŸ˜± ğŸ˜Œ ğŸŒ¸ ğŸ™Œ ğŸ˜‹ ğŸ’— ğŸ’š ğŸ˜ ğŸ’› ğŸ™‚ ğŸ’“ ğŸ¤© ğŸ˜„ ğŸ˜€ ğŸ–¤ ğŸ˜ƒ ğŸ’¯ ğŸ™ˆ ğŸ‘‡ ğŸ¶ ğŸ˜’ ğŸ¤­ â£ï¸â— ğŸ˜œ ğŸ’‹ ğŸ‘€ ğŸ˜ª ğŸ˜‘ ğŸ’¥ ğŸ™‹ ğŸ˜ ğŸ˜© ğŸ˜¡ ğŸ¤ª ğŸ‘Š â˜€ï¸ ğŸ˜¥ ğŸ¤¤ ğŸ‘‰ ğŸ’ƒ ğŸ˜³ âœ‹ ğŸ˜š ğŸ˜ ğŸ˜´ ğŸŒŸ ğŸ˜¬ ğŸ™ƒ ğŸ€ ğŸŒ· ğŸ˜» ğŸ˜“ â­ âœ… ğŸŒˆ ğŸ˜ˆ ğŸ¤˜ğŸ’¦ âœ”ï¸ ğŸ˜£ ğŸƒ ğŸ’ â˜¹ï¸ ğŸŠ ğŸ’˜ ğŸ˜  â˜ï¸ ğŸ˜• ğŸŒº ğŸ‚ ğŸŒ» ğŸ˜ ğŸ–• ğŸ’ ğŸ™Š ğŸ˜¹ ğŸ—£ï¸ ğŸ’« ğŸ’€ ğŸ‘‘ ğŸµ ğŸ¤ ğŸ˜› ğŸ”´ ğŸ˜¤ ğŸŒ¼ ğŸ˜« âš½ ğŸ¤™ â˜• ğŸ† ğŸ§¡ ğŸ âš¡ ğŸŒ ğŸˆ âŒ âœŠ ğŸ‘‹ ğŸ˜² ğŸŒ¿ ğŸ¤« ğŸ‘ˆ ğŸ˜® ğŸ™† ğŸ» ğŸƒ ğŸ¶ ğŸ’ ğŸ˜° ğŸ¤¨ ğŸ˜¶ ğŸ¤ ğŸš¶ ğŸ’° ğŸ“ ğŸ’¢ğŸ‡ºğŸ‡¸ ğŸ¤Ÿ ğŸ™ ğŸš¨ ğŸ’¨ ğŸ¤¬ âœˆï¸ ğŸ€ ğŸº ğŸ¤“ ğŸ˜™ ğŸ’Ÿ ğŸŒ± ğŸ˜– ğŸ‘¶ â–¶ï¸ â¡ï¸ â“ ğŸ’ ğŸ’¸ â¬‡ï¸ ğŸ˜¨ ğŸŒš ğŸ¦‹ ğŸ˜· ğŸ•º âš ï¸ ğŸ™… ğŸ˜Ÿ ğŸ˜µ ğŸ‘ ğŸ¤² ğŸ¤  ğŸ¤§ ğŸ“Œ ğŸ”µ ğŸ’… ğŸ§ ğŸ¾ ğŸ’ ğŸ˜— ğŸ¤‘ ğŸš€ ğŸŒŠ ğŸ¤¯ ğŸ· â˜ï¸ ğŸ’§ ğŸ˜¯ ğŸ’† ğŸ‘† ğŸ¤ ğŸ™‡ ğŸ‘ â„ï¸ ğŸŒ´ ğŸ‡§ğŸ‡· ğŸ’£ ğŸ¸ ğŸ’Œ ğŸ“ ğŸ¥€ ğŸ¤¢ ğŸ‘… ğŸ’¡ ğŸ’© â‰ï¸ ğŸ‘ ğŸ“¸ ğŸ‘» ğŸ¤ ğŸ¤® ğŸ¼ âœï¸ ğŸš© ğŸ ğŸŠ ğŸ‘¼ ğŸ’ ğŸ“£ ğŸ¥‚ â¤µï¸ ğŸ“± â˜” ğŸŒ™ğŸ¾ ğŸ§ ğŸ â­• ğŸ€ â˜ ï¸ âš« ğŸ–ï¸ ğŸ˜§ ğŸ¯ ğŸ“² â˜˜ï¸ ğŸ‘ï¸ ğŸ· ğŸ‘„ ğŸŸ ğŸ° ğŸ’¤ ğŸ•Šï¸ ğŸ“º ğŸ’­ ğŸ± ğŸ ğŸ‡²ğŸ‡½ ğŸ§š ğŸ” ğŸ“¢ ğŸ“· ğŸ• ğŸ¸ ğŸ”« ğŸ¤š ğŸ­ ğŸ† ğŸ’‰ ğŸŒ ğŸ˜¦ ğŸŒ€ ğŸ‘¿ â˜‘ï¸ ğŸ¥ ğŸŒ§ï¸ ğŸ‘½ ğŸ‹ ğŸ¤’ ğŸ¤¡ ğŸ« ğŸ“š ğŸ ğŸ¤• ğŸ¦„ ğŸ… ğŸš— ğŸš« ğŸ’µ âš¾ ğŸ”ª ğŸ”” â™¨ï¸ ğŸŒ³ ğŸ”Š ğŸ¬ ğŸ’ ğŸ¼ ğŸœ ğŸ¼ ğŸ™‰ ğŸˆ ğŸ» ğŸ¤¸ ğŸŒ ğŸ‘¸ ğŸ• ğŸŒ ğŸ¦ âšª ğŸ‘© ğŸ˜¿ ğŸ‚ ğŸ“ â° ğŸ” ğŸŒ ğŸŒ  ğŸ™€ â–ªï¸ â˜ï¸ ğŸ‘¹ ğŸ‰ ğŸ¥ ğŸŒ¶ï¸ 1ï¸âƒ£ ğŸŒµ ğŸ‡®ğŸ‡³ ğŸ‘§ ğŸ„ ğŸ‘® ğŸ’® ğŸ° ğŸ”· ğŸŒ¾ ğŸ”¹ ğŸ‡¹ğŸ‡· ğŸ¥‡ ğŸ‡®ğŸ‡¹ğŸª ğŸ‡¦ğŸ‡· ğŸ›‘ ğŸ ğŸ“ ğŸ‡¨ğŸ‡¦ ğŸ ğŸ¦ ğŸ˜½ ğŸš¬ ğŸ– ğŸ´ ğŸ†˜ ğŸ¤œ ğŸ¿ ğŸ” ğŸ“ ğŸ‡¯ğŸ‡µ ğŸ® ğŸ‡ 2ï¸âƒ£ ğŸ  ğŸ¤° ğŸ£ ğŸ’ ğŸ‘¦ ğŸ© ğŸ£ ğŸ¤› ğŸ‘¯ ğŸ³ï¸â€ğŸŒˆ â™ ï¸ ğŸŒ² ğŸ´ ğŸ› ğŸ† ğŸ’‘ ğŸ ğŸ¯ â˜„ï¸ ğŸ˜¸ ğŸš ğŸ¬ ğŸ™ï¸ ğŸ‡¨ğŸ‡´ ğŸ³ ğŸ¦€ ğŸ¥ƒ ğŸ”¸ ğŸ’Š ğŸ ğŸ¹ â™¦ï¸ ğŸ”® ğŸ‘¨ ğŸ¸ ğŸŒ ğŸ‘´ ğŸ§¢ ğŸ½ ğŸ” ğŸ» â¬†ï¸ âœ‚ï¸ ğŸ‘« ğŸ‘£ ğŸ¯ ğŸ® ğŸµ ğŸ¦ ğŸ‡¬ğŸ‡§ ã€°ï¸ ğŸ‘­ ğŸ¬ ğŸŸ ğŸ‘™ âœ–ï¸ ğŸ“© ğŸ‘µ ğŸ¨ ğŸ‡«ğŸ‡· ğŸ– âœï¸ â™»ï¸ ğŸ¥Š ğŸ¦… ğŸ’¬ ğŸ‡¨ğŸ‡± ğŸ¢ ğŸ”° ğŸ”¶ ğŸ—ï¸ ğŸ’„ ğŸ‘  ğŸ¥• â– ğŸº ğŸ“– ğŸ ğŸŒƒ âœ´ï¸ ğŸŒŒ ğŸ“ ğŸ‘‚ ğŸ¤ ğŸ ğŸ”» ğŸ’» ğŸ¦ ğŸ‡©ğŸ‡ª ğŸŒ› â†˜ï¸ âœï¸ ğŸ§˜ ğŸ¥ ğŸ–ï¸ âšœï¸ â• ğŸ…°ï¸ ğŸš´ ğŸ’  ãŠ—ï¸ ğŸ™ â™£ï¸ ğŸ¡ â© ğŸ¨ ğŸ  ğŸ‡°ğŸ‡· ğŸ— ğŸš® â–«ï¸ ğŸŒªï¸ ğŸ˜¼ ğŸ‘¤ ğŸŠ ğŸŒ½ ğŸ© ğŸ‡ªğŸ‡¸ ğŸ¹ ğŸˆ â—€ï¸ â†”ï¸ ğŸ¡ ğŸ‡µğŸ‡° ğŸ‡ ğŸ¥© ğŸ 3ï¸âƒ£ â¬…ï¸ ğŸŒ â†—ï¸ ğŸ½ï¸ ğŸ§€ ğŸ¥¦ ğŸœ âš”ï¸ğŸ˜º ğŸ¥ ğŸ„ ğŸ”¨ ğŸï¸ ğŸ”† ğŸ‘¥ ğŸ‘“ ğŸ¥’ ğŸˆ ğŸ‡µğŸ‡­ ğŸ‹ï¸ 0ï¸âƒ£ ğŸš˜ ğŸ¦– ğŸŒ• ğŸ­ ğŸ‘¾ ğŸ³ ğŸµï¸ ğŸ§ ğŸ”— ğŸ•‹ â˜ƒï¸ ğŸŒ… ğŸ¤´ ğŸ–– ğŸŠ ğŸ˜ ğŸŒ¤ï¸ ğŸ¥‘ ğŸ¥š â›ˆï¸ ğŸµ ğŸ”œ ğŸ¶ ğŸ„ ğŸ‡»ğŸ‡ª ğŸ® ğŸ¦ˆ ğŸš² â›” ğŸ•¯ï¸ â• ğŸ”º ğŸ’‡ ğŸ§  ğŸ“» ğŸ¥¤ ğŸ ğŸ¥ ğŸ’´ ğŸŒ¬ï¸ ğŸ¥“ ğŸ™ âš“ ğŸ‘° ğŸ‚ ğŸ“½ï¸ ğŸ… â›… ğŸ‡¦ğŸ‡ª ğŸ‡µğŸ‡ª ğŸ§œ ğŸ“® â›³ ğŸ”½ ğŸš‚ ğŸŒï¸ ğŸ‡ ğŸï¸ ğŸ² ğŸ¥› ğŸ£ ğŸ‘± ğŸ ğŸ•·ï¸ ğŸ¦ ğŸ”˜ ğŸ… ğŸ‡ ğŸ” ğŸ© ğŸ‘º ğŸ…±ï¸ ğŸš™ ğŸ§ âš–ï¸ ğŸƒ ğŸŒ„ ğŸ¾ ğŸš ğŸº â‡ï¸ ğŸ« âŒš ğŸŒ‹ ğŸ’’ ğŸ‘³ â ğŸ‘Ÿ ğŸ‘ƒ ğŸ›Œ ğŸš“ â¬ ğŸ“ˆ â›„ â±ï¸ ğŸ˜¾ ğŸ›« ğŸ¤± ğŸ â˜®ï¸ ğŸšƒ â³ ğŸŒœ ğŸ“¹ ğŸ› ğŸ‘” ğŸ‘— ğŸŒ ğŸ± ğŸŒ° ğŸŒ® ğŸ•µï¸ ğŸ”… âœ‰ï¸ ğŸ‡ªğŸ‡¬ ğŸš‘ ğŸ“¦ ğŸ¤¥ ğŸ”„ ğŸ¤³ ğŸ’² ğŸ‹ ğŸ—“ï¸ ğŸ¤– ğŸ¥” ğŸ†— ğŸ”‘ ğŸ‡¨ğŸ‡³ ğŸ¤ 4ï¸âƒ£ ğŸ‘ â° ğŸ‘©â€ğŸ“ â˜‚ï¸ ğŸ‡¦ğŸ‡¹ ğŸ¦† ğŸšŒ ğŸ’¿ ğŸ¥ ğŸ‹ ğŸš’ ğŸ ğŸ‡ªğŸ‡¨ ğŸ¥ ğŸ· ğŸ—½ ğŸ—¡ï¸ ğŸ ğŸ­ ğŸ™ ğŸŒ‘ ğŸš” ğŸ‡®ğŸ‡© ğŸš¿ ğŸ¥ ğŸ•Œ ğŸ€ ğŸ›¡ï¸ ğŸ”’ âœ³ï¸ ğŸ•¶ï¸ ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘© ğŸŸï¸ ğŸ‰ ğŸ”± ğŸ” ğŸ‡¦ğŸ‡º âš°ï¸ ğŸ© ğŸ¦‘ ğŸ§Ÿ ğŸ†• ğŸ¦Š ğŸ‘• ğŸ¹ ğŸ‡©ğŸ‡¿ ğŸ‘¬ ğŸ± ğŸ“° ğŸ¥‹ ğŸš¤ ğŸ° 5ï¸âƒ£ ğŸ¦‰ ğŸš¢ ğŸŒ¨ï¸ ğŸ“† ğŸ—ï¸ ğŸŒ ğŸ§” ğŸ’³ ğŸ‡ºğŸ‡¾ ğŸ¥— â˜¯ï¸ âš™ï¸ ğŸ’¶ â›©ï¸ ğŸ—» âœ’ï¸ ğŸ‡ºğŸ‡² ğŸ‡µğŸ‡¹ ğŸ ğŸ‘· ğŸ›ï¸ ğŸï¸ ğŸ”› ğŸ”™ ğŸ—¼ ğŸ–ï¸ ğŸšº ğŸ¹ ğŸ¥– ğŸ‡µğŸ‡· ğŸ¡ ğŸ” ğŸŸï¸ ğŸ–¥ï¸ ğŸŒ­ ğŸ‡¹ğŸ‡­ âœ¡ï¸ ğŸ’ ğŸ›€ ğŸ“… ğŸ–‹ï¸ ğŸ‡¸ğŸ‡ª ğŸï¸ ğŸª ğŸ™ ğŸ› ğŸ“• ğŸ‘’ ğŸ–‡ï¸ â” ğŸ„ ğŸ•¸ï¸ ğŸ¥œ ğŸ•´ï¸ ğŸ¥Ÿ â†™ï¸ â—¾ ğŸ² ğŸ´ ğŸ¦Œ ğŸ†” ğŸ‘› ğŸšš â†ªï¸ ğŸ‡¬ğŸ‡· ğŸ“¿ ğŸŒ«ï¸ ğŸŒ‚ ğŸ•‰ï¸ ğŸ†š ğŸ“‰ ğŸ—¨ï¸ ğŸ›’ ğŸ“› ğŸ‡³ğŸ‡± ğŸ¿ï¸ ğŸ…¾ï¸ â˜¢ï¸ ğŸ‡²ğŸ‡¦ ğŸƒ â›½ ğŸ…¿ï¸ ğŸ¦‡ â¤´ï¸ â›µ ğŸ‘ ğŸ”“ ğŸ§ â›°ï¸ ğŸ“ ğŸ¦ ğŸ”Œ ğŸ³ï¸ ğŸš½ ğŸ² âš’ï¸ â™Š ğŸ‘¢ ğŸ§™ ğŸ‡µğŸ‡± â›ª ğŸ‡§ğŸ‡ª ğŸ ğŸ”– ğŸ”‹ ğŸ“¡ ğŸŒ‡ ğŸ‰ ğŸ‘ª ğŸ‘– ğŸ“Š ğŸ† ğŸ” ğŸ›©ï¸ ğŸ¡ ğŸƒ ğŸ‘©â€ğŸ’» ğŸŒ©ï¸ ğŸ‡³ğŸ‡¬ ğŸ 6ï¸âƒ£ â›¹ï¸ ğŸ—¯ï¸ ğŸ‡¨ğŸ‡­ ğŸ¢ ğŸ—ºï¸ ğŸš• ğŸ‡·ğŸ‡º â“‚ï¸ â›±ï¸ ğŸ« ğŸ“€ ğŸ†™ ğŸ¤¼ ğŸ¨ ğŸ¦‚ ğŸ’· ğŸ¥ˆ ğŸ‘¨â€ğŸ’» ğŸ›ï¸ â—¼ï¸ ğŸš„ ğŸ§– ğŸ  ğŸ ğŸ—³ï¸ ğŸ® ğŸ¥ª ğŸŒ¥ï¸ ğŸšª ãŠ™ï¸ ğŸ—ï¸ ğŸ‘¨â€âš•ï¸ ğŸ–Šï¸ â¬› ğŸ†’ ğŸ‡¨ğŸ‡º ğŸ¥§ ğŸ‘©â€âš•ï¸ ğŸ‡³ğŸ‡® ğŸ‘¨â€ğŸ“ ğŸš§ â›“ï¸ ğŸ›µ ğŸ¥… ğŸš… ğŸ–¼ï¸ â™¿ ğŸ“ ğŸ€„ ğŸ–Œï¸ ğŸ‰ ğŸ“¬ ğŸš ğŸ—‘ï¸ ğŸ¤µ ğŸ·ï¸ ğŸŒ¡ï¸ ğŸ ğŸ‡¯ğŸ‡² ğŸ¦’ ğŸ’ ğŸ‡µğŸ‡¾ ğŸ‡ºğŸ‡¦ ğŸ‡²ğŸ‡¨ ğŸ¥‰ 7ï¸âƒ£ âŒ› ğŸŒ’ ğŸ¥¥ ğŸ… ğŸ§• ğŸ› â™‹ ğŸ§‘ ğŸ‡©ğŸ‡´ ğŸ‡®ğŸ‡ª ğŸ›¸ ğŸ§’ ğŸ“§ ğŸ¥¢ ğŸ¢ ğŸª ğŸ‡®ğŸ‡± ğŸ‘¨â€ğŸ³ ğŸš› ğŸ¥„ ğŸ¤¹ ğŸ¢ ğŸ’ˆ ğŸ‘˜ ğŸ‡³ğŸ‡´ ğŸ‡¬ğŸ‡­ ğŸ”ï¸ ã€½ï¸ ğŸš¦ ğŸ‡¿ğŸ‡¦ ğŸ‡¹ğŸ‡³ ğŸ’¼ â™ˆ ğŸ¦“ ğŸš» ğŸ° â—½ ğŸ¦— ğŸ¤¾ ğŸ‘š ğŸ‘¡ â›ï¸ 9ï¸âƒ£ ğŸ›ï¸ ğŸ— ğŸŒ¦ï¸ ğŸ‡¸ğŸ‡¦ ğŸš¹ ğŸ‡¾ğŸ‡ª â˜ªï¸ ğŸ¤º ğŸš£ ğŸ—¿ ğŸ¥˜ ğŸ‡©ğŸ‡° ğŸ¦• ğŸ‡±ğŸ‡· ğŸ•ï¸ â˜£ï¸ ğŸŒ† â†•ï¸ ğŸ“¨ ğŸ¨ ğŸ•¹ï¸ ğŸ‘©â€ğŸ³ ğŸ‡¨ğŸ‡®ğŸ“¯ ğŸ‘œ ğŸ˜ï¸ ğŸ« â›º ğŸ‘©â€ğŸ« ğŸ•³ï¸ ğŸ¯ ğŸŒ“ ğŸŒ‰ 8ï¸âƒ£ ğŸ’‚ ğŸ”‰ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ğŸ‡ªğŸ‡º ğŸšœ ğŸ”• ğŸ“¥ ğŸŒ” ğŸ™ï¸ ğŸ¥¨ ğŸ‡²ğŸ‡¾ ğŸ“˜ ğŸ“— ğŸ“œ â™ ğŸ‡§ğŸ‡´ ğŸœï¸ ğŸ˜ ğŸ›¬ ğŸŒ¯ ğŸ—ï¸ ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ ğŸš¼ ğŸï¸ ğŸ”ˆ ğŸ•°ï¸ ğŸ“ ğŸ‡¨ğŸ‡· ğŸ‘¨â€ğŸŒ¾ ğŸ¦ƒ ğŸ”¦ ğŸ”ƒ ğŸ‡¸ğŸ‡» ğŸ›³ï¸ ğŸŒ˜ ğŸ‡§ğŸ‡© ğŸ§› ğŸ‘©â€â¤ï¸â€ğŸ‘© ğŸ”š ğŸ”Ÿ â„¹ï¸ ğŸ›¢ï¸ ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ ğŸ‡¸ğŸ‡© ğŸ”­ ğŸ‡®ğŸ‡¶ ğŸ ğŸ¥£ ğŸŒ— â†–ï¸ ğŸ³ ğŸ‘¨â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ ğŸ‘¨â€ğŸ« ğŸ“„ ğŸ‡¶ğŸ‡¦ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ğŸšï¸ ğŸ› ï¸ ğŸ†“ ğŸ‡µğŸ‡¸ ğŸ›ï¸ â™ ğŸ§¦ ğŸ—¾ ğŸ‘©â€ğŸŒ¾ ğŸ‘ ğŸ‡¬ğŸ‡¹ ğŸ§¤ ğŸ§ â¿ ğŸ‡»ğŸ‡³ ğŸ“’ â™‰ â™“ ğŸš­ ğŸ”§ â™Œ â†©ï¸ â™’ ğŸ¦ ğŸˆµ ğŸ¥« ğŸŒ– ğŸ›´ ğŸš– ğŸ¥™ ğŸ›°ï¸ ğŸ¦ ğŸ‡¸ğŸ‡¬ âºï¸ ğŸ–ï¸ â›¸ï¸ ğŸ“™ ğŸ‘² ğŸ‚ *ï¸âƒ£ ğŸ”² ğŸ‡­ğŸ‡º ğŸš ğŸ‘¨â€â¤ï¸â€ğŸ‘¨ ğŸ”‡ ğŸ¦” ğŸ”¯ ğŸšµ ğŸš¯ ğŸ•› ğŸ“¼ ğŸ§“ ğŸ›ï¸ ğŸ‡¨ğŸ‡¿ ğŸ‡­ğŸ‡° ğŸ’º ğŸ‘©â€ğŸ¤ â›² âš›ï¸ ğŸ•’ ğŸ“¶ ğŸš‹ ğŸ‡±ğŸ‡§ ğŸ“  ğŸš‡ â²ï¸ âª ğŸ‡°ğŸ‡¼ ğŸ›ƒ ğŸ‡­ğŸ‡³ ğŸ‘¨â€âœˆï¸ ğŸ““ ğŸ‘©â€ğŸ‘§ â™ ğŸ‘ ğŸ“‹ ğŸ”¼ ğŸ‡¨ğŸ‡µ ğŸ‡¯ğŸ‡´ ğŸ“ƒ ğŸ”¬ ğŸ‡«ğŸ‡® ğŸš¥ ğŸ‡±ğŸ‡° â™ ğŸ‡µğŸ‡¦ ğŸ‡¸ğŸ‡¾ ğŸš¾ ğŸ‡­ğŸ‡· ğŸ‡³ğŸ‡¿ ğŸš ğŸ¸ ğŸ”³ ğŸ›‚ ğŸ“µ â›‘ï¸ ğŸšï¸ ğŸ½ ğŸš° ğŸª â›·ï¸ ğŸ‘©â€ğŸ’¼ â™‘ ğŸ‡¨ğŸ‡² ğŸ‡±ğŸ‡¾ â« ğŸ£ ğŸš‰ ğŸ›… âš•ï¸ â›´ï¸ ğŸ‘ï¸â€ğŸ—¨ï¸ ğŸ§ â—»ï¸ ğŸ‘©â€ğŸ”¬ â¹ï¸ ğŸ‡·ğŸ‡´ ğŸ‘©â€ğŸ‘¦ â¬œ#ï¸âƒ£ ğŸ‡¦ğŸ‡± ğŸ‡¹ğŸ‡¼ ğŸ›£ï¸ ğŸ¤ ğŸ›„ ğŸ‡®ğŸ‡¸ ğŸ¬ ğŸ‘¨â€ğŸ¤ ğŸ• ğŸ¦ ğŸ‘¨â€ğŸ’¼ ğŸ’¹ â˜¸ï¸ ğŸ“´ ğŸ“ ğŸ–±ï¸ ğŸ‡­ğŸ‡¹ ğŸ‡¸ğŸ‡³ ğŸ”© ğŸˆ² ğŸ´ ğŸ“³ â˜¦ï¸ ğŸš† ğŸ“ ğŸ“” ğŸ‡¦ğŸ‡« ğŸ‘©â€ğŸ¨ ğŸ•‘ ğŸš¸ ğŸ§£ ğŸ‘¨â€ğŸš€ ğŸ‡§ğŸ‡­ ğŸ­ ğŸº ğŸ‡¬ğŸ‡³ ğŸ¤½ ğŸ›¥ï¸ ğŸ‡²ğŸ‡± ğŸŒ ğŸ¤¶ ğŸ‡¦ğŸ‡¿ ğŸ’½ ğŸ‡¦ğŸ‡´ ğŸš ğŸ‡®ğŸ‡· ğŸ‡³ğŸ‡µ ğŸ—’ï¸ ğŸ‡¨ğŸ‡© ğŸ›‹ï¸ âŒ¨ï¸ ğŸ† ğŸ§— ğŸ§¥ ğŸ‡°ğŸ‡ª ğŸ›¶ ğŸ“‘ ğŸ‘ ğŸ‡¦ğŸ‡² â¯ï¸ ğŸ‡¬ğŸ‡ª ğŸ’± ğŸ‘¨â€ğŸ¨ ğŸ‡§ğŸ‡¬ ğŸ‡ªğŸ‡¦ ğŸ‘©â€âš–ï¸ ğŸ•“ ğŸ‘©â€ğŸš€ ğŸš ğŸ‘¨â€ğŸš’ ğŸ†– ğŸ”€ ğŸ‘¨â€ğŸ”¬ ğŸ‘¨â€âš–ï¸ ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ ğŸ¥  ğŸš³ ğŸ‡§ğŸ‡¯ ğŸ‡²ğŸ‡¬ ğŸ‡ªğŸ‡ª â­ï¸ ğŸ• ğŸˆš ğŸš¡ ğŸ•• ğŸ‡·ğŸ‡¸ ğŸ‰‘ ğŸ“‚ ğŸ‡¹ğŸ‡¿ ğŸ“« ğŸ•˜ ğŸšŠ ğŸšˆ ğŸ”‚ â— ğŸ•— ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ ğŸˆ¹ ğŸ‡±ğŸ‡º ğŸ›¤ï¸ ğŸ‡ºğŸ‡¬ ğŸ•– ğŸˆ´ ğŸ‘¨â€ğŸ”§ ğŸ” ğŸ‡§ğŸ‡¼ ğŸš· ğŸ‡²ğŸ‡° ğŸ‡±ğŸ‡» ğŸ•™ ğŸ‡¹ğŸ‡¹ ğŸ‡±ğŸ‡¹ ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ ğŸ‘¨â€ğŸ‘§ ğŸ“Ÿ ğŸ‘©â€âœˆï¸ â¸ï¸ ğŸ‘©â€ğŸš’ ğŸ‡¿ğŸ‡¼ ğŸ¥¡ ğŸ‡¸ğŸ‡° ğŸ•”ğŸ‡´ğŸ‡² ğŸ’¾ ğŸ“¤ âš—ï¸ ğŸ”  ğŸš ğŸ†‘ ğŸ‡²ğŸ‡² ğŸ‘¨â€ğŸ‘¦ ğŸ‡²ğŸ‡¹ ğŸ•š ğŸ‡§ğŸ‡¦ ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ğŸ¿ ğŸ”¤ ğŸˆ¶ ğŸš± ğŸš ğŸ‡³ğŸ‡ª ğŸ‘©â€ğŸ”§ ğŸ‡§ğŸ‡¸ ğŸ• ğŸ‡°ğŸ‡­ ğŸ”¢ ğŸ‡¨ğŸ‡¾ ğŸ“­ ğŸ“ª ğŸˆ³ ğŸ‡²ğŸ‡· ğŸ‘©â€â¤ï¸â€ğŸ‘¨ ğŸ‘©â€ğŸ‘©â€ğŸ‘§ ğŸ‡°ğŸ‡¿ ğŸ–¨ï¸ â®ï¸ ğŸ‡¬ğŸ‡¾ ğŸ‡¸ğŸ‡® ğŸ‡§ğŸ‡¾ ğŸ‡¸ğŸ‡´ ğŸ•  ğŸ‡¦ğŸ‡¼ ğŸ–²ï¸ âš±ï¸ ğŸ‡²ğŸ‡ª ğŸ‡¿ğŸ‡² ğŸ‡§ğŸ‡§ ğŸ‡¹ğŸ‡¯ ğŸ‡¨ğŸ‡¬ ğŸ‡ºğŸ‡¿ ğŸ‡¸ğŸ‡± ğŸ‡³ğŸ‡¦ ğŸšŸ ğŸ‡§ğŸ‡® ğŸ‡½ğŸ‡° ğŸ‡¦ğŸ‡® ğŸ‡ªğŸ‡¹ ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ ğŸ‡¦ğŸ‡¬ ğŸ‘¨â€ğŸ­ ğŸ‘©â€ğŸ‘§â€ğŸ‘§ ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘§ ğŸˆ¯ ğŸš  ğŸ•Ÿ ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ğŸ‡·ğŸ‡¼ ğŸ‡¦ğŸ‡½ ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ ğŸ‡«ğŸ‡¯ ğŸ¥Œ ğŸ‡¦ğŸ‡¸ ğŸ‡¹ğŸ‡© ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ ğŸ‡¦ğŸ‡© ğŸ‡¬ğŸ‡² ğŸ‡¬ğŸ‡¦ ğŸ—‚ï¸ ğŸ‡§ğŸ‡² ğŸ‘©â€ğŸ­ğŸ• ğŸ•¦ ğŸ•¢ ğŸ•œ ğŸ‡²ğŸ‡³ ğŸ‡¹ğŸ‡¬ ğŸ•¤ ğŸ‡²ğŸ‡¿ ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦ ğŸˆ‚ï¸ ğŸ‡¬ğŸ‡¼ ğŸ‡§ğŸ‡³ ğŸ‡²ğŸ‡» ğŸ•§ ğŸ‡²ğŸ‡´ ğŸ•¡ â› ğŸ‡¹ğŸ‡´ ğŸ•£ ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ ğŸ‡ªğŸ‡· ğŸ‡¦ğŸ‡¨ ğŸ‡°ğŸ‡¬ ğŸ‡¦ğŸ‡¶ ğŸ‡¨ğŸ‡» ğŸ‡§ğŸ‡« ğŸ‡°ğŸ‡µ ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ ğŸ•¥ ğŸ‡²ğŸ‡© ğŸ‡®ğŸ‡¨ ğŸ‡»ğŸ‡¦ ğŸ‡¬ğŸ‡© ğŸ‡®ğŸ‡² ğŸ‘©â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ ğŸ‡²ğŸ‡« ğŸ“‡ ğŸˆº ğŸ‡±ğŸ‡¦ ğŸ›· ğŸ• ğŸ‡²ğŸ‡¼ ğŸ‘©â€ğŸ‘©â€ğŸ‘¦ ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§ ğŸˆ·ï¸ ğŸ‘¨â€ğŸ‘§â€ğŸ‘§ ğŸ‡ºğŸ‡³ ğŸ—ƒï¸ ğŸ‡±ğŸ‡¸ ğŸ—œï¸ ğŸ‡¬ğŸ‡º ğŸ‡§ğŸ‡» ğŸ”¡ ğŸ‡«ğŸ‡´ ğŸ‡²ğŸ‡º ğŸ‡µğŸ‡¬ ğŸ‡¨ğŸ‡¼ ğŸ‡¬ğŸ‡¬ ğŸˆ ğŸ”£ ğŸ‡¼ğŸ‡¸ ğŸ‡¸ğŸ‡· ğŸ‡¹ğŸ‡² ğŸ‡¸ğŸ‡¸ ğŸ—„ï¸ ğŸ‡§ğŸ‡¹ ğŸ‡¸ğŸ‡½ ğŸ‡°ğŸ‡² ğŸˆ¸ ğŸ‡©ğŸ‡² ğŸ‡ªğŸ‡­ ğŸ‡§ğŸ‡¿ ğŸ‡»ğŸ‡® ğŸ‡¬ğŸ‡« ğŸ‡¸ğŸ‡² ğŸ‡©ğŸ‡¯ ğŸ‡¹ğŸ‡¨ğŸ‡±ğŸ‡¨ ğŸ‡»ğŸ‡º ğŸ‡µğŸ‡« ğŸ‡¬ğŸ‡® ğŸ‡¸ğŸ‡¨ ğŸ‡°ğŸ‡³ ğŸ‡¯ğŸ‡ª ğŸ‡²ğŸ‡¶ ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ ğŸ‡·ğŸ‡ª ğŸ‡¸ğŸ‡¿ ğŸ‡°ğŸ‡¾ âï¸ ğŸ‡»ğŸ‡¨ ğŸ‡»ğŸ‡¬ ğŸ‡±ğŸ‡® ğŸ‡¨ğŸ‡¨ ğŸ‡¨ğŸ‡« ğŸ‡¸ğŸ‡¹ ğŸ‡¬ğŸ‡± ğŸ‡µğŸ‡¼ ğŸ‡¬ğŸ‡µ ğŸ‡­ğŸ‡² ğŸ‡¨ğŸ‡° ğŸ‡«ğŸ‡° ğŸ‡µğŸ‡³ ğŸ‡³ğŸ‡« ğŸ‡¸ğŸ‡§ ğŸ‡¹ğŸ‡± ğŸ‡«ğŸ‡² ğŸ‡®ğŸ‡´ ğŸ‡²ğŸ‡­ ğŸ‡¬ğŸ‡¶ ğŸ‡¹ğŸ‡°	ğŸ‡§ğŸ‡¶ ğŸ‡²ğŸ‡µ ğŸ‡¨ğŸ‡½ ğŸ‡°ğŸ‡® ğŸ‡³ğŸ‡º ğŸ‡¸ğŸ‡¯ ğŸ‡²ğŸ‡¸ ğŸ‡¸ğŸ‡­ ğŸ‡¹ğŸ‡» ğŸ‡³ğŸ‡¨ ğŸ‡³ğŸ‡· ğŸ‡§ğŸ‡± ğŸ‡¼ğŸ‡« ğŸ‡¬ğŸ‡¸",
    timestamp: moment().valueOf(),
    name: "- Tip"
  });

  // listen for client message
  socket.on("message", function(message) {
    console.log("Message Received : " + message.text);
    // to show all current users
    if (message.text === "@currentUsers") {
      sendCurrentUsers(socket);
    } else {
      //broadcast to all users except for sender
      message.timestamp = moment().valueOf();
      //socket.broadcast.emit("message",message);
      // now message should be only sent to users who are in same room
      socket.broadcast.to(clientInfo[socket.id].room).emit("message", message);
      //socket.emit.to(clientInfo[socket.id].room).emit("message", message);
    }

  });
});
http.listen(PORT, function() {
  console.log("server started");
});
